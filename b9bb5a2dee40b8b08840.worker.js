!function(t){var n={};function e(r){if(n[r])return n[r].exports;var u=n[r]={i:r,l:!1,exports:{}};return t[r].call(u.exports,u,u.exports,e),u.l=!0,u.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var u in t)e.d(r,u,function(n){return t[n]}.bind(null,u));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="/mml2/",e(e.s=0)}([function(t,n,e){"use strict";function r(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function u(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function o(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?u(Object(e),!0).forEach((function(n){r(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):u(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function i(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function c(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,n){if(t){if("string"===typeof t)return i(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?i(t,n):void 0}}(t))){var n=0,e=function(){};return{s:e,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,u,o=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){c=!0,u=t},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw u}}}}e.r(n),e.d(n,"startSimulation",(function(){return j})),e.d(n,"getState",(function(){return h})),e.d(n,"stopSimulation",(function(){return S})),e.d(n,"setUserInput",(function(){return P}));var a={and:function(t,n){return[p(t,n).every((function(t){return t}))]},or:function(t,n){return[p(t,n).some((function(t){return t}))]},constant:function(t,n){return[t.value]},led:function(t,n){return[]},buffer:function(t,n){return p(t,n)},switch:function(t,n){return[Boolean(l(t,n))]}};function s(){return{id:y(),connections:[]}}function f(t,n){var e={outputs:{},inputs:{}};if(n){var r,u=c(t.gates);try{for(u.s();!(r=u.n()).done;)for(var o=r.value,i=a[o.type](o,n),s=0;s<i.length;s++)e.outputs[o.outputs[s].id]=1===(i[s]^o.outputs[s].isInverted)}catch(b){u.e(b)}finally{u.f()}Object.assign(e.inputs,n.inputs)}else{var f,p=c(t.gates);try{for(p.s();!(f=p.n()).done;){var l,d=c(f.value.outputs);try{for(d.s();!(l=d.n()).done;){var y=l.value;e.outputs[y.id]=!1}}catch(b){d.e(b)}finally{d.f()}}}catch(b){p.e(b)}finally{p.f()}}return e}function p(t,n){return t.inputs.map((function(t){return 1===(n.outputs[t.connections[0]]^t.isInverted)}))}function l(t,n){return n.inputs[t.id]}var d=0;function y(){return d>=Number.MAX_SAFE_INTEGER&&(d=0),d++}var b=function(t){return Object.fromEntries(t.reduce((function(t,n){return t.concat(n.inputs.map((function(t){return t.id})),n.outputs.map((function(t){return t.id})))}),[]).map((function(t){return[t,!0]})))},m={nextState:f,getOutputs:function(t,n){return t.outputs.map((function(t){return n.outputs[t.id]}))},getInputs:p,getUserInput:l,setUserInput:function(t,n,e){n.inputs[t.id]=e},fastForward:function(t,n,e){for(var r=0;r<n;r++)e=f(t,e);return e},renumber:function(t){var n=o({},t),e=d,r=function(t){return d<Number.MAX_SAFE_INTEGER-t?t+d:t-Number.MAX_SAFE_INTEGER+d},u=function(t){var n=o({},t,{id:r(t.id)});return n.id>e&&(e=n.id),n.connections&&(n.connections=n.connections.map(r)),n};return n.gates=n.gates.map((function(t){var n=u(t);return n.inputs=n.inputs.map(u),n.outputs=n.outputs.map(u),n})),d=e+1,n},connect:function(t,n){t.connections.push(n.id),n.connections.push(t.id)},circuit:function(t){return{gates:t}},andGate:function(){return{id:y(),type:"and",inputs:[s(),s()],outputs:Object.seal([s()])}},orGate:function(){return{id:y(),type:"or",inputs:[s(),s()],outputs:Object.seal([s()])}},constantGate:function(t){return{id:y(),type:"constant",inputs:Object.seal([]),outputs:Object.seal([s()]),value:t||!1}},switchGate:function(){return{id:y(),type:"switch",inputs:Object.seal([]),outputs:Object.seal([s()])}},led:function(){return{id:y(),type:"led",inputs:Object.seal([s()]),outputs:Object.seal([])}},buffer:function(){return{id:y(),type:"buffer",inputs:Object.seal([s()]),outputs:Object.seal([s()])}},removeInvalidConnections:function(t){var n=b(t);return t.map((function(t){var e=o({},t),r=function(t){return o({},t,{connections:t.connections.filter((function(t){return n[t]}))})};return e.inputs=e.inputs.map(r),e.outputs=e.outputs.map(r),e}))},getValidPins:b},v=null,O=null,g=null;function j(t,n){if(v||O||g)throw new Error("simulation already started");v=n||m.nextState(t),O=function(){v=m.nextState(t,v)},g=setInterval(O,1)}function h(){return v}function S(){clearInterval(g),v=null,O=null,g=null}function P(t,n){m.setUserInput(t,v,n)}addEventListener("message",(function(t){var e,r=t.data,u=r.type,o=r.method,i=r.id,c=r.params;"RPC"===u&&o&&((e=n[o])?Promise.resolve().then((function(){return e.apply(n,c)})):Promise.reject("No such method")).then((function(t){postMessage({type:"RPC",id:i,result:t})})).catch((function(t){var n={message:t};t.stack&&(n.message=t.message,n.stack=t.stack,n.name=t.name),postMessage({type:"RPC",id:i,error:n})}))})),postMessage({type:"RPC",method:"ready"})}]);
//# sourceMappingURL=b9bb5a2dee40b8b08840.worker.js.map